{{- if .Values.istio.enabled }}
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: model-service-virtualservice
spec:
  hosts:
    - model-service
  http:
    # Route for canary callers (app-service v2 → model-service v2)
    - match:
        - sourceLabels:
            version: v2-canary
      route:
        - destination:
            host: model-service
            subset: canary

    # Default: stable callers (app-service v1 → model-service v1)
    - route:
        - destination:
            host: model-service
            subset: stable
{{- end }}
